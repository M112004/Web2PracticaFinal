{
	"info": {
		"_postman_id": "a5b4c3d2-e1f0-4321-9876-abcdef123456",
		"name": "Gestión de Albaranes",
		"description": "Colección para probar las funcionalidades relacionadas con la gestión de albaranes.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Usuarios",
			"item": [
				{
					"name": "Registro de Usuario",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Token is returned\", function () {",
									"    pm.expect(jsonData.token).to.exist;",
									"    pm.collectionVariables.set(\"auth_token\", jsonData.token);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{email}}\",\n    \"password\": \"{{password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/users/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"register"
							]
						},
						"description": "Registro de un nuevo usuario en el sistema"
					},
					"response": []
				},
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Token is returned\", function () {",
									"    pm.expect(jsonData.token).to.exist;",
									"    pm.collectionVariables.set(\"auth_token\", jsonData.token);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"{{email}}\",\n    \"password\": \"{{password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/users/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"login"
							]
						},
						"description": "Iniciar sesión en el sistema"
					},
					"response": []
				},
				{
					"name": "Validar Email",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"code\": \"{{validation_code}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/users/validation",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"validation"
							]
						},
						"description": "Validar el correo electrónico del usuario"
					},
					"response": []
				}
			],
			"description": "Operaciones relacionadas con usuarios"
		},
		{
			"name": "Clientes",
			"item": [
				{
					"name": "Crear Cliente",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Client ID is returned\", function () {",
									"    pm.expect(jsonData._id).to.exist;",
									"    pm.collectionVariables.set(\"client_id\", jsonData._id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Cliente Demo\",\n    \"email\": \"cliente@demo.com\",\n    \"phone\": \"123456789\",\n    \"address\": \"Calle Principal 123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/clients",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"clients"
							]
						},
						"description": "Crear un nuevo cliente"
					},
					"response": []
				},
				{
					"name": "Listar Clientes",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/clients",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"clients"
							]
						},
						"description": "Obtener la lista de clientes"
					},
					"response": []
				}
			],
			"description": "Operaciones relacionadas con los clientes"
		},
		{
			"name": "Proyectos",
			"item": [
				{
					"name": "Crear Proyecto",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Project ID is returned\", function () {",
									"    pm.expect(jsonData._id).to.exist;",
									"    pm.collectionVariables.set(\"project_id\", jsonData._id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"title\": \"Proyecto Demo\",\n    \"description\": \"Este es un proyecto de prueba\",\n    \"client\": \"{{client_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/projects",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"projects"
							]
						},
						"description": "Crear un nuevo proyecto"
					},
					"response": []
				},
				{
					"name": "Listar Proyectos",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/projects",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"projects"
							]
						},
						"description": "Obtener la lista de proyectos"
					},
					"response": []
				}
			],
			"description": "Operaciones relacionadas con los proyectos"
		},
		{
			"name": "Albaranes",
			"item": [
				{
					"name": "Crear Albarán Simple (Horas)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Delivery note ID is returned\", function () {",
									"    pm.expect(jsonData._id).to.exist;",
									"    pm.collectionVariables.set(\"deliverynote_id_simple\", jsonData._id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"project\": \"{{project_id}}\",\n    \"items\": [\n        {\n            \"type\": \"hours\",\n            \"person\": \"Juan Pérez\",\n            \"hours\": 8,\n            \"unitPrice\": 50\n        }\n    ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/deliverynote",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote"
							]
						},
						"description": "Crear un albarán simple con horas trabajadas"
					},
					"response": []
				},
				{
					"name": "Crear Albarán Múltiple (Horas y Materiales)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Delivery note ID is returned\", function () {",
									"    pm.expect(jsonData._id).to.exist;",
									"    pm.collectionVariables.set(\"deliverynote_id_multiple\", jsonData._id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"project\": \"{{project_id}}\",\n    \"items\": [\n        {\n            \"type\": \"hours\",\n            \"person\": \"Juan Pérez\",\n            \"hours\": 8,\n            \"unitPrice\": 50\n        },\n        {\n            \"type\": \"hours\",\n            \"person\": \"Ana García\",\n            \"hours\": 6,\n            \"unitPrice\": 45\n        },\n        {\n            \"type\": \"material\",\n            \"description\": \"Materiales de construcción\",\n            \"quantity\": 10,\n            \"unitPrice\": 25\n        }\n    ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/deliverynote",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote"
							]
						},
						"description": "Crear un albarán con múltiples personas/horas y materiales"
					},
					"response": []
				},
				{
					"name": "Listar Albaranes",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/deliverynote",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote"
							]
						},
						"description": "Obtener la lista de albaranes"
					},
					"response": []
				},
				{
					"name": "Mostrar Albarán Simple",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Delivery note has populated data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.project).to.be.an('object');",
									"    pm.expect(jsonData.project.client).to.be.an('object');",
									"    pm.expect(jsonData.createdBy).to.be.an('object');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/deliverynote/{{deliverynote_id_simple}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote",
								"{{deliverynote_id_simple}}"
							]
						},
						"description": "Obtener un albarán específico con datos de usuario, cliente y proyecto"
					},
					"response": []
				},
				{
					"name": "Mostrar Albarán Múltiple",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Delivery note has populated data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.project).to.be.an('object');",
									"    pm.expect(jsonData.project.client).to.be.an('object');",
									"    pm.expect(jsonData.createdBy).to.be.an('object');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/deliverynote/{{deliverynote_id_multiple}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote",
								"{{deliverynote_id_multiple}}"
							]
						},
						"description": "Obtener un albarán múltiple específico con datos de usuario, cliente y proyecto"
					},
					"response": []
				},
				{
					"name": "Descargar Albarán PDF",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Content-Type is application/pdf\", function () {",
									"    pm.response.to.have.header(\"Content-Type\");",
									"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/pdf\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/deliverynote/pdf/{{deliverynote_id_simple}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote",
								"pdf",
								"{{deliverynote_id_simple}}"
							]
						},
						"description": "Descargar un albarán en formato PDF"
					},
					"response": []
				},
				{
					"name": "Firmar Albarán",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Signature URL is returned\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.signatureUrl).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "signature",
									"type": "file",
									"src": "/path/to/signature.png"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/deliverynote/sign/{{deliverynote_id_simple}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote",
								"sign",
								"{{deliverynote_id_simple}}"
							]
						},
						"description": "Firmar un albarán subiendo una imagen"
					},
					"response": []
				},
				{
					"name": "Descargar Albarán Firmado PDF",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 302\", function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 302]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/deliverynote/pdf/{{deliverynote_id_simple}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote",
								"pdf",
								"{{deliverynote_id_simple}}"
							]
						},
						"description": "Descargar un albarán firmado en formato PDF (debería redirigir a IPFS)"
					},
					"response": []
				},
				{
					"name": "Borrar Albarán (No firmado)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Success is true\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/deliverynote/{{deliverynote_id_multiple}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote",
								"{{deliverynote_id_multiple}}"
							]
						},
						"description": "Borrar un albarán no firmado"
					},
					"response": []
				},
				{
					"name": "Intentar Borrar Albarán Firmado",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 (Bad Request)\", function() {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message is returned\", function() {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.error).to.exist;",
									"    pm.expect(jsonData.error).to.include(\"No se puede borrar un albarán firmado\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/deliverynote/{{deliverynote_id_simple}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"deliverynote",
								"{{deliverynote_id_simple}}"
							]
						},
						"description": "Intentar borrar un albarán firmado (debe fallar)"
					},
					"response": []
				}
			],
			"description": "Operaciones relacionadas con los albaranes"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:4000",
			"type": "string"
		},
		{
			"key": "email",
			"value": "test@example.com",
			"type": "string"
		},
		{
			"key": "password",
			"value": "password123",
			"type": "string"
		},
		{
			"key": "validation_code",
			"value": "ABCDEF",
			"type": "string"
		},
		{
			"key": "auth_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "client_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "project_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "deliverynote_id_simple",
			"value": "",
			"type": "string"
		},
		{
			"key": "deliverynote_id_multiple",
			"value": "",
			"type": "string"
		}
	]
}